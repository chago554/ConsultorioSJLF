<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.3/font/bootstrap-icons.min.css">
<script>

    $(function () {
        cargarPacientes();
    });

    function cargarPacientes() {
        $.ajax({
            url: backend + "/pacientesSJLF/listarSJLF",
            type: 'post',
            datatype: 'json',
            xhrFields: { withCredentials: true },

            success: function (respuesta) {
                mostrarPacientes(respuesta);
            }
        });
    }
    //   <!-- Es para mostrar los datos de mi BD en las tablas-->
    function mostrarPacientes(lista) {
        var body = '';
        var sangre = '';
        $.each(lista, function (i, paciente) {

            switch (paciente.tipoSangre) {
                case 'OPositivo':
                    sangre = 'O+';
                    break;
                case 'ONegativo':
                    sangre = 'O-';
                    break;
                case 'APositivo':
                    sangre = 'A+';
                    break;
                case 'ANegativo':
                    sangre = 'A-';
                    break;
                case 'BPositivo':
                    sangre = 'B+';
                    break;
                case 'BNegativo':
                    sangre = 'B-'
                    break;
                case 'ABPositivo':
                    sangre = 'AB+';
                    break;
                case 'ABNegativo':
                    sangre = 'AB-';
                    break;
                default: sangre = 'Tipo de sangre no encontrada';
            }

            body += '<tr class="table-' + ((i % 2 == 0) ? 'success' : 'light') + '">' +
                '<td scope="row">' + paciente.nombreSJLF + '</td>' +
                '<td scope="row">' + paciente.curpSJLF + '</td>' +
                '<td scope="row">' + sangre + '</td>' +
                '<td scope="row d-flex"> <button type="button" class="btn btnmodificar btn-info" onclick="modificarPaciente(' + paciente.id + ');"><i class="bi bi-pencil-square"></i></button> <button type="button" class=" btn btn-danger btnelimina" onclick="eliminarPaciente(' + paciente.id + ');"><i class="bi bi-trash3-fill"></i></button>   </td>' +
                '</tr>';
        });
        $('#tablaPacientes > tbody').html(body);
    }

    //eliminar 
    function eliminarPaciente(idPaciente) {
        var datos = {
            id: idPaciente
        }
        $.ajax({
            url: backend + "/pacientesSJLF/eliminarSJLF",
            type: 'post',
            datatype: 'json',
            data: JSON.stringify(datos),
            contentType: 'application/json',
            xhrFields: { withCredentials: true },

            success: function (respuesta) {

                if(respuesta == '¡Se eliminó el paciente correctamente!'){
                    $.gritter.add({
                        title: "¡Listo!",
                        text: respuesta,
                        sticky: false,
                        image: 'correcto.png'
                    }); cargarPacientes();

                }else{

                    $.gritter.add({
                        title: "¡Ups, Error!",
                        text: respuesta,
                        sticky: false,
                        image: 'cancelar.png'
                    })
                }
            
            }
        });
    }

    //modificar tarea
    function modificarPaciente(idPaciente) {
        $("#divPrincipal").load("Pacientes/modificar.html", function () {
            cargarPaciente(idPaciente);
        });
    }
</script>

<div class="row">
    <div class="col p-5">
        <table class="table table-hover" id="tablaPacientes">
            <legend class=" h1 text-dark fs-bold ">Pacientes</legend>
            <thead class=" align-items-center">
                <tr class="table-dark ">
                    <th scope="col" class="align-middle">Nombre</th>
                    <th scope="col" class="align-middle">CURP
                    <th scope="col" class="align-middle">Tipo de sangre</th>
        
                    <th scope="col"><button type="button" onclick=' $("#divPrincipal").load("Pacientes/nuevo.html");'
                            class="btn btn-success align-middle">Nuevo paciente <i class="bi bi-plus-circle"></i></button></th>
                </tr>
            </thead>
            <tbody>
            </tbody>
        </table>
    </div>
</div>
